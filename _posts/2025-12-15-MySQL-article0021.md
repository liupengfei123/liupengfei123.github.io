---
layout:     page
title:      "学习InnoDB些许感想"
subtitle:   "《MySql是怎么样运行的》感想：学习InnoDB些许感想"
date:       2025-12-15
author:     "Lpf"
header-img: "img/home-bg.jpg"
tags:
    - MySQL
    - 感想
---


在《MySQL是怎么样运行的》这一书中学习了InnoDB引擎：

记录是以说明格式存储的，页面中行记录存储以及查找方式，是如何将index页构建成B+树的从而形成索引，又学习到了通过段的概念将相近的页面存储在磁盘的连续区域内从而将随机IO转为顺序IO提升读写性能的，在行记录，页面格式，B+树的创建，段的概念整个组成了InnoDB中数据是在磁盘文件时怎么存储的。

为了联通内存和磁盘InnoDB又设计了Buffer Pool来缓存页面，通过自行设置LRU算法来保证页面在Buffer Pool的命中率，从而减少IO读取，规避了因为预读页面和全表等冷数据对热缓存数据的冲击。又通过延迟刷新脏页来减少同步等待的时间和随机IO写入。
当将脏页写入到磁盘时为了保证页面的完整性，通过使用双写缓冲区来保证在写入16KB页面时出现系统崩溃（机械硬盘的原子性写入只有512B即一个扇区的大小），可以通过双写缓冲区中的页面将页面还原，来保证原子性。

因为延迟将脏页刷盘了所以磁盘与内存之间存在了版本差异，为了保证修改的持久性所以InnoDB设计了Redo日志，来保证修改的操作可以及时的存储到磁盘中。
为了保证事务的原子性，通过设计了undo日志保证事务的回滚，为了保证事务的隔离性通过rundo日志建立MVCC，保证了事务一致性读的可能性。

***当一个事物在处理过程可能出现问题，无法保证事物可以正确执行时，就先通过一种更快速的方式先处理好做好保障工作，在处理原始操作，真在处理复杂事物中出现问题，就可以通过之前的保障方式进行还原或者其他处理。***

如：
InnoDB在将脏页写入磁盘时，因为机械硬盘的原子写只有512B远小于页面的16KB，所以在写入过程中会将一个页面多次写入，在这个过程中就可能会出现崩溃到导致磁盘中的页面不完整。InnoDB就是通过双写缓冲区来处理该情况的，即向将一个批次脏页写入双写缓冲区（硬盘中的一个连续空间）中，因为是顺序IO所以写入时比较快的，当双写缓冲区的数据写入到磁盘中之后，再将这一批脏页写入到原本各自的磁盘位置中（因为各个页面位置不一样所以随机IO效率比较慢），当出现崩溃时就可以通过双写缓冲区中的页面数据进行还原了。

再如：
在redo日志也用运用到，InnoDB为了保证事务的持久性，就会在事务提交时将redo日志刷新到磁盘中，而对应的脏页延后在刷盘。 因为redo日志刷新磁盘时同步的，所以InnoDB就有使用了一些优化：一是在redo日志内存中存储在log block页中，该页只有512B只需要机械硬盘一次原子写入就可以了，二是所有的log block页是穿成了一个链表，在写入磁盘是顺序写入的，